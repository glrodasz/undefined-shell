---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Container from "../components/Container.astro";
import SimpleAnalytics from "../components/SimpleAnalytics.astro";
import LanguageVersionBanner from "../components/LanguageVersionBanner.astro";
import { type Locale, getLocaleFromAstro } from "../i18n/config";
import { getMessages } from "../i18n";

type LanguageVersion = {
  language: string;
  url: string;
};

type Props = CollectionEntry<"posts">["data"] & {
  readingTime?: number;
  locale?: Locale;
  languageVersions?: LanguageVersion[];
};

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  readingTime,
  languageVersions,
} = Astro.props;

const locale = getLocaleFromAstro(Astro);
const messages = getMessages(locale);
const tabTitle = `${title} • ${messages.site.description} • ${messages.site.title} by ${messages.site.author}`;
---

<html lang={locale}>
  <head>
    <BaseHead
      title={title}
      tabTitle={tabTitle}
      description={description}
      image={heroImage}
    />
    <style>
      .hero-image {
        width: 100%;
        margin-bottom: 1em;
      }
      .hero-image img {
        display: block;
        margin: 0 auto;
        aspect-ratio: 48 / 9;
        object-fit: cover;
        width: 100%;
      }
      .prose {
        max-width: 920px;
        width: 100%;
        margin: auto;
        color: var(--color-black-pearl-700);
      }
      .title {
        padding: 1em 0 0;
        text-align: left;
        line-height: 1;
      }
      .title h1 {
        margin: 0;
        color: var(--color-black-pearl-900);
      }
      .date,
      .reading-time {
        color: rgb(var(--gray));
      }

      .subheader {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 1em;
      }

      .has-hero-image {
        padding-top: 0;
      }

      @media (max-width: 920px) {
        .hero-image img {
          aspect-ratio: 24 / 9;
        }

        .subheader {
          flex-direction: column;
          gap: 0.5em;
        }

        .date {
          display: flex;
          flex-direction: column;
        }
      }
    </style>
  </head>

  <body>
    <Header locale={locale} />
    <div class="hero-image">
      {heroImage && <img width={1200} height={510} src={heroImage} alt="" />}
    </div>
    <Container>
      <main class={heroImage ? "has-hero-image" : ""}>
        <article>
          <div class="prose">
            <div class="title">
              <div class="subheader">
                <div class="date">
                  <FormattedDate
                    date={pubDate}
                    leadingComma={Boolean(updatedDate)}
                    locale={locale}
                  />
                  {
                    updatedDate && (
                      <span class="last-updated-on">
                        {messages.blog.lastUpdatedOn}{" "}
                        <FormattedDate date={updatedDate} locale={locale} />
                      </span>
                    )
                  }
                </div>
                {
                  readingTime && (
                    <strong class="reading-time">
                      ⏱️ {readingTime} {messages.blog.minRead}
                    </strong>
                  )
                }
              </div>
              <h1>{title}</h1>
            </div>
            <LanguageVersionBanner
              languageVersions={languageVersions}
              currentLocale={locale}
            />
            <div class="blog-content">
              <slot />
            </div>
          </div>
        </article>
      </main>
    </Container>
    <Footer locale={locale} />
    <SimpleAnalytics />
    <style>
      .blog-content {
        margin-top: 3rem;
      }
    </style>
  </body>
</html>
